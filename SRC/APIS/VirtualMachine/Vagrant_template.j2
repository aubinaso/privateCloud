Vagrant.configure(2) do |config|
  {{#if count}}
  (1..{{count}}).each do |i|
  {{#when count 'noteq' 1}}
  config.vm.define "{{hostname}}-#{i}" do |machine|
  {{/when}}
  {{#when count 'eq' 1}}
  config.vm.define "{{hostname}}" do |machine|
  {{/when}}
    machine.vm.box = '{{box}}'
    {{#if ip}}
    machine.vm.network "private_network", ip: '{{ip}}'
    {{/if}}
    {{#if hostname}}
    {{#when count 'noteq' 1}}
    machine.vm.hostname = "{{hostname}}-#{i}"
    {{/when}}
    {{#when count 'eq' 1}}
    machine.vm.hostname = "{{hostname}}"
    {{/when}}
    {{/if}}
    {{#if synced_folder}}
    {{/if}}
    {{#if provider}}
    machine.vm.provider "{{provider}}" do |vb|
      {{#if name}}
      vb.name = "{{name}}-#{i}"
      {{/if}}
      {{#if cpus}}
      vb.cpus = '{{cpus}}'
      {{/if}}
      {{#if memory}}
      vb.memory = '{{memory}}'
      {{/if}}
    end
    {{/if}}
  end
  end
  {{/if}}
end